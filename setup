#!/bin/zsh

# Brew binaries that will be installed
bins=(
    "php@7.4"
    "composer"
    "nvm"
    "neovim"
    "llvm"
    "ripgrep"
    "fzf"
    "tmux"
    "hugo"
    "kubectl"
    "minikube"
)

# Brew casks that needs to be installed
casks=(
    "firefox"
    "adobe-acrobat-reader"
    "whatsapp"
    "postman"
    "dbngin"
    "visual-studio-code"
    "slack"
    "discord"
    "tableplus"
    "sequel-pro"
    "notion"
)

# =============================================================================
# Language support - Compilers and Interpreters
# =============================================================================
# The first thing for the setup is to get the necessary language support, i.e.,
# all the compilers and interpreters binaries, apples comes with a get utility 
# called xcode-select (xcode command line tools) that has most of the compilers
# below will check xcode command line tools is present or not, else install it.
# =============================================================================
if xcode-select -p 1>/dev/null 
    then echo "xcode-command line tools already installed"
    else xcode-select --install
fi 

# =============================================================================
# System Package Manger - Homebrew
# =============================================================================
# The installation of libraries and apps should be simple and automated, 
# Homebrew - The Missing Package Manager for MacOS is one popular choic. 
# =============================================================================
if brew -h 1>/dev/null
    then echo "Brew.sh already installed."
    else echo /bin/bash -c "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/master/install.sh)"
fi 

# =============================================================================
# Install brew binaries and casks
# =============================================================================
# This section installs all the binaries specified in the above bins array, do
# not modify the code below.
# =============================================================================
for binary in "${bins[@]}"
do
    # get the name of the binary (ex- php in php@7.4)
    b=`echo $binary | cut -d \@ -f 1`
    # check if the binary is already present, otherwise install
    if brew list --formula | grep "$b" 1>/dev/null
        then echo "$binary already installed"
        else brew install "$binary"
    fi
done

for c in "${casks[@]}"
do
    # check is cask is present or not, if not install
    if brew list --cask | grep "$c" 1>/dev/null
        then echo "$c is already installed"
        else brew casks install "$c"
    fi
done

# =============================================================================
# Binary specific support
# =============================================================================
# Although brew has made the binary installation easy, but there might be cases
# where you need to manually register some post-installation command.
# =============================================================================

# Post-Installation for Node Version Manager (NVM)
if [[ " ${bins[@]} " =~ " nvm " ]]; then
    [ ! -d ~/.nvm ] && mkdir ~/.nvm
    # source the nvm.sh file to add nvm in path
    [ -s "/usr/local/opt/nvm/nvm.sh" ] && . "/usr/local/opt/nvm/nvm.sh"
    # Install lts support for nodejs, yarn and update npm
    nvm install --lts
    npm install -g npm yarn 
fi
